# Compute Engine Dataflow Job

A flink job, monitoring the different components, that resemble a part of the dataflow of the ARGO monitoring service.
It is a streaming job, consuming messages from an ams subscription that have been generated by a nagios probe, writes and reads the messages to Mongo, then writes and reads the messages to HDFS and finally publishes the message again back to AMS for the probe to retrieve it, and examine, whether or not, any of the above-mentioned functionalities didn't behave as expected.

## Configuration file
The configuration file that contains important information for the job to run, should be in json format, containing all the following fields.
```
{
  "ams_host" : "The ams host, e.g. https://example.host.gr",
  "ams_project" : "The ams project that to which the rest of the information belong to",
  "ams_token" : "Token to use in order to pull/push data from the ams",
  "ams_pull_sub" : "The subscription to which the probe publishes its messages",
  "ams_publish_topic": "The topic from which the probe will read the 'report' message",
  "ams_pull_url" : "https://{{ams_host}}/v1/projects/{{ams_project}}/subscriptions/{{ams_pull_sub}}:pull?key={{ams_token}}",
  "ams_publish_url" : "https://{{ams_host}}/v1/projects/{{ams_project}}/topics/{{ams_publish_topic}}:publish?key={{ams_token}}",
  "mongo_host" : "Mongo host",
  "mongo_port" : Mongo port (should be declared as an integer, not as a string, e.g. 27017)
  "mongo_db": "Mongo Database that the flink job should use ",
  "mongo_col" : "Mongo collection that the flink job should write/read",
  "hdfs_nn" : "Hdfs namenode",
  "hdfs_port" : Namenode port (should be declared as an integer, not as a string, e.g. 9000)
  "hdfs_filename": "The filename that will be used to read/write to hdfs, e.g. check.txt",
  "hdfs_user": "Hdfs user",
  "hdfs_path" : "hdfs://{{hdfs_nn}}:{{hdfs_port}}/user/{{hdfs_user}}/{{hdfs_filename}}",
  "ssl_enabled": Whether or not to verify the authenticity of the SSl certificate on the server hosting AMS(should be declared as boolean not string),
  "proxy_enabled": Whether or not to try and connect through a proxy(should be declared as boolean not String),
  "proxy_scheme": "",
  "proxy_url": "proxy url",
  "proxy_port": proxy_port (should be declared as an integer, not as a string, e.g. 9000)
  "retry_count": 5 (should be declared as an integer, how many times should it retry to connect to ams before dropping the connection)
  "retry_interval": 5000 (should be declared as an integer in milliseconds how oftrn should it try to reconnect)
}
```
